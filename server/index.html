<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaalClient Example</title>
  <style>
    * {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 14pt;
      margin: 0;
      padding: 0;
    }

    html, body {
      background-color: rgb(247, 247, 247);
    }

    h1 {
      font-size: 20pt;
      text-align: center;
    }

    label {
      display:inline-block;
      min-width: 140px;
    }

    input {
      border: 1px solid #ccc;
      padding: 5px;
    }

    .button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
    }

    #container {
      margin: 20px;
    }

    #url {
      margin-top: 10px;
      margin-bottom: 20px;
      min-width: 500px;
    }

    #datalabel {
      vertical-align: top;
      margin-top: 5px;
    }

    #mydata {
      padding: 5px;
      border: 1px solid #ccc;
      min-width: 500px;
      min-height: 200px;
      margin-bottom: 20px;
    }

    #apikey {
      min-width: 500px;
      margin-bottom: 20px;
    }

    #results {
      margin: 20px;
    }

    #curl {
      font-family: 'Courier New', Courier, monospace;
      padding: 20px;
    }

    #addFees, #tag, #type {
      margin-bottom: 20px;
    }
  </style>
  <script>
    function showCurl(apikey, type, tag, mydata, url) {
      let data='curl -X POST'
      if (apikey) data += ` -H 'Authorization: Bearer ${apikey}'`
      if (type) data += ` -H 'Content-Type: ${type}'`
      if (tag) data += ` -H 'X-Tag: ${tag}'`
      if (mydata) data += ` -d "${mydata}"`
      data += ` ${url}`

      document.getElementById("curl").innerHTML = data
    }

    function writeData() {
      var url = document.getElementById("url").value
      var type = document.getElementById("type").value
      var mydata = document.getElementById("mydata").value
      var apikey = document.getElementById("apikey").value
      var tag = document.getElementById("tag").value
      
      showCurl(apikey, type, tag, mydata, url)
      return

      fetch(url, {
        method: "POST",
        body: mydata,
        headers: {
          "Authorization": "Bearer " + apikey,
          "Content-Type": type,
          "X-Tag": tag
        },
      }).then(function (response) {
        response.json().then(function (j) {
          if (response.status === 201) {
            showCurl(apikey, type, tag, mydata, url)

            var url = (apikey.startsWith('testnet_') ? 'https://test.whatsonchain.com/tx/' : 'https://www.whatsonchain.com/tx/') + j.txid
            document.getElementById("results").innerHTML += `<div><a href="${url}">${url}</a></div>`
            document.getElementById("mydata").value = ""
          } else {
            alert("There was an error writing: " + response.statusText)
          }
        }).catch(function (err) {
          alert("Could not read response: " + err.message)
        })
      }).catch(function (err) {
        console.log(err)
      })
    }

  </script>
</head>

<body>
  <div id="container">
    <h1>TaalClient Example</h1>
    <div>
    <div>
      <label for="url">TaalClient URL:</label>
      <input id="url", type="text" value="http://localhost:9500/api/v1/write"></input>
    </div>
    <div>
      <label for="apikey">API key:</label>
      <input id="apikey" , type="text"></input>
    </div>
    <div>
      <label for="tag">Tag (optional):</label>
      <input id="tag" , type="text"></input>
    </div>
    <div>
      <label for="type">MIME type:</label>
      <input id="type" , type="text" value='text/plain'></input>
    </div>
    <div>
      <label id='datalabel' for="mydata">Data:</label>
      <textarea id="mydata" placeholder="Enter text to send to blockchain"></textarea>
    </div>
    <div id='curl'></div>
    <div>
      <input type="button" class="button" onClick="writeData()" value="Broadcast"></input>
    </div>
    <div id="results"></div>
  </div>
</body>

</html>